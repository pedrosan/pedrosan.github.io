#!/usr/bin/perl -w 

#---------------------------------------------------------------------------------------------------

use feature 'unicode_strings';  # CHECK THIS SETTING (http://perldoc.perl.org/perlunifaq.html)
use utf8;

# use Text::Unidecode;
binmode STDIN, ':encoding(UTF-8)';
binmode STDOUT, ':encoding(UTF-8)';

use Getopt::Long;
Getopt::Long::Configure('no_ignore_case');

$debug=0;
GetOptions ('d|debug' => \$debug );

while (<STDIN>) {

    chomp;
    if( $debug ) {  
        print "I: $_\n";
    } 

    #--------------------------------------------------
    # FIX missed HASHTAGS at line beginning
    #  + ADDED 04.17 to pass1 but then used here in pass5 to avoid re-processing from scratch
    #  + then ACTUALLY USED in remove_tags_content
    #----
    # s/^#((?!(?:[a-z_]*[0-9]){5})[_[:alnum:]]*[[:alpha:]][_[:alnum:]]*)\b/<HASHTAG_$1_HASHTAG> /g;

    #--------------------------------------------------
    # clear weird characters
    #----
    # s|¾|3/4|g;
    # s|½|1/2|g;
    # s|¼|1/4|g;
    s|¾|<NUMBER>|g;
    s|½|<NUMBER>|g;
    s|¼|<NUMBER>|g;

    s/(♥|❤|😂|@|👍|😍|😊|😁|😭|😘|💤|💜|☺|﻿|💗|💙|•|🎶|👎|💚|👏|😳|💰|😃|❕|🎉|😒|😉|✌||😔|😡|😱|♡|😢|😏|😜|👌|👊|🙏|🔫||😝|°|😄|💋|🏀|😲|★|)/<WEIRDO>/g;
    s/(||💛|█|😖|😞|♫||🍻|💪|🔥|¤|♪|½|💔|☔|||💨|||😷||¯||🎈|�|👙||🍸|🎵|😌|😣|🚀||¡|⚾||💃|😠|✈|🍀|||🎁|💩|😥|😚||)/<WEIRDO>/g;
    s/(。|▒|👋|🙌||🎧|💢|🍺|👉|||🍴|🏃|💁|☁|✨|||||👈|💘|😪|¾|☆|🎓|😰|¬|™|||🌹|🎀|―|✋|||||📱|☕|⚡|💓|😓||🌟|👯|💦|·|¼)/<WEIRDO>/g;
    s/(×|►|❌||||🎤|🎸|🏊|👗|⇨|✊||💅|💆||🇸|🌴|🎂|👠|💍|¢|─|||🇺|💉|▽|◕||🍰|🐱|👼|😨|🚗|➡||🍔|📖|‿|✔||||🏈|🐎|🐶|​|‎)/<WEIRDO>/g;
    s/(|・|！|💣|📝|⌒|♬||||🌊|🍦|💇|🙅|⁰|▬||🐧|👩|👶|💎|💟|🚬|¿|☮|⛄|✧|➠|||🌺|🌻|🍟|🏧|🐠|👟|💄|💐|🙆|√|◄|☎||||||🍃||)/<WEIRDO>/g;
    s/(🍎|🍳|🎥|👀|👃|👸|👽|💏|§|∇|═||||||🌷|🌸|🍆|🍓|🐟|🐷|👑|👵|®|˘|☞|☼|⛳|❔|⬅||||||🇧|🇬|🌅|🐳|👫|👻|👿|📺|🚑|🚙|←|∩||﹏)/<WEIRDO>/g;
    s/(≦|≧|●|◡|☂|✪|||||||||｡|🇮|🇹|🌙|🍉|🍞|🍧|🏆|🐒|🐬|👆|👣|👲|💊|📷|🔊|😎|¹|‐|→|║|☝|♩|⚽|⬆||||||||||￣|)/<WEIRDO>/g;
    s/(）|🌀|🍤|🎬|🏄|🏥|🐯|👂|👜|👧|👮|💑|💝|📢|🔒|😋|🚓|¦|¨|²|³|¶|†|┌|┐|▀|▲|☜|✮|✿||||||||||||||||||||)/<WEIRDO>/g;
    s/(|||||||🇪|🌵|🍁|🍶|🎄|🎾|🐦|🐺|👇|👕|👢|👦|💀|💡|💵|🔨|🔪|🚶|©|±|¸|‑|⇦|⇧|−|∞|≥|⊙|⋆|╠|╥|▁|▓|♂|⛵|✂|✰|❣|【|】|〜|㉨|)/<WEIRDO>/g;
    s/(||||||||||||||||||||||||||||･|🆒|🌆|🌾|🍂|🍛|🍝|🎅|🐚|🐤|🐮|🐴|🐵|👄|👐|👴|💂|💕|💿|🔴|🚌|～)/<WEIRDO>/g;
    s/(🚕|🚤|🛀|˚|‽|∆|∫|⋰|⌣|┬|┻|╣|╯|╰|▔|▼|◠|☯|☹|☻|☽|☾|♀|♒|♦|⚠|⛪|✦|✭|❂|❧|⭕||||||||||||||||||)/<WEIRDO>/g;
    s/(||||||||||||||||||||||||||||||||||||（|－|｀|🇩|🇯|🇵|🌇|🌎|🌞|🍅|🍊|🍣|🎎|🎱)/<WEIRDO>/g;
    s/(🎿|🏫|🐔|🐘|🐛|🐨|🐭|🐰|🐸|👔|👱|👳|👾|💼|📣|📲|📻|🔔|🕛|🚉|🚚|🚲|🚽|÷|٭|‡|›|₂|₪|₮|⅛|⅜|↓|↨|∂|∮|⊂|⊃|⊥|⌘||||||||||)/<WEIRDO>/g;
    s/(━|╬|░|□|▶|▿|◆|◢|◣|☠|☢|☣|☨|☭|♊|♎|♨|⛅|✆|✗|✝|✞|❥|〽||||||||||||||||||||||||||)/<WEIRDO>/g;
    s/(||||||||||||||||||||||||||||||||||||||||||||︶|︹|︺|＄|／|＞)/<WEIRDO>/g;
    s/(＼|＾|＿|￡|￥|￦|🆔|🆗|🇷|🈳|🈵|🈹|🉐|🌈|🌕|🍜|🍹|🎆|🎇|🎡|🎢|🎫|🎯|🎷|🎺|🏠|🏢|🏩|🐍|🐙|🐢|🐫|🐹|👒|👓|👡|👨|💺|💻|💽|📫|📮|📹|🔑|🔓|🕑|🕒|🕕|🕖|🕘)/<WEIRDO>/g;
    s/(🕙|🗻|🗽|😼|🙈|🙉|🙊|🙋|🚇|🚒|🚢|🚥|🚧|🚺)/<WEIRDO>/g;

    #--------------------------------------------------
    # clean consecutive TAGS
    #----
    # s/(<[A-Z]+>)( +\1)+/$1/g;
    #
    # OR
    # s/(<[A-Z]+>)([^[:alnum:]]+\1)+/$1_FIXEDTAG/g;
    s/(<[A-Z]+>)([^[:alnum:]]+\1)+/$1/g;

    #--------------------------------------------------
    # remove <PERIOD>
    #----
    s/\.<PERIOD>/./g;
    s/([[:alpha:]])<PERIOD> /$1 /g;


    #--------------------------------------------------
    # remove <SPACE>
    #----
    s/ +<SPACE> +/ /g;
    s/^<SPACE> +//g;
    s/ +<SPACE>([^[:alnum:]]+)$/$1/g;

    
    #--------------------------------------------------
    # remove <WEIRDO>
    #----
    s/<WEIRDO>//g;
    
    #--------------------------------------------------
    # remove quotes from single quoted words
    #----
    s/([^[:alpha:]])["']([[:alpha:]\-_]+)["']([^[:alpha:]])/$1$2$3/g;
    

    #--------------------------------------------------
    # remove <HASHTAG> ??? (maybe)
    #----
    # s/<HASHTAG>//g;

    #--------------------------------------------------
    # remove sequences of non-alpha characters (somehow still present)
    #----
    

    #--------------------------------------------------
    # clear row BEGINNINGS with non-alpha characters
    #----
    s|^(?![^[:alpha:]]*<[A-Z])([^[:alpha:]\n]+)||;    

    #--------------------------------------------------
    # clear row ENDINGS with odd sequences 
    #----


    #================================================
    # MORE
    #--------------------------------------------------
    # check for EMPTY LINES
    #----


    #================================================
    if( $debug ) {  
        print "O: $_\n";
        print "-----\n";
    } else {
        print "$_\n";
    }

}

#-----------------------------------------------------------
